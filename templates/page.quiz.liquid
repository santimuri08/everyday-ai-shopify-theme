{% layout 'theme' %}

<section class="meal-plan-quiz">
  <div class="quiz-container">
    <div class="quiz-header">
      <h1>üçΩÔ∏è Find Your Perfect Meal Plan</h1>
      <p>Answer 5 quick questions to discover which plan fits your student lifestyle</p>
    </div>
    
    <div id="quiz-content">
      <!-- Question 1 -->
      <div class="quiz-question active" data-question="1">
        <h2>How much time do you have for meal prep?</h2>
        <div class="quiz-options">
          <button class="quiz-option" data-value="minimal" data-next="2">
            <i class="fas fa-clock"></i>
            <div>
              <strong>Under 10 min/day</strong>
              <span>I'm super busy with classes</span>
            </div>
          </button>
          <button class="quiz-option" data-value="moderate" data-next="2">
            <i class="fas fa-hourglass-half"></i>
            <div>
              <strong>10-30 min/day</strong>
              <span>I can dedicate some time</span>
            </div>
          </button>
          <button class="quiz-option" data-value="ample" data-next="2">
            <i class="fas fa-calendar-check"></i>
            <div>
              <strong>30+ min/day</strong>
              <span>I enjoy cooking</span>
            </div>
          </button>
        </div>
      </div>
      
      <!-- Question 2 -->
      <div class="quiz-question" data-question="2">
        <h2>What's your monthly food budget?</h2>
        <div class="quiz-options">
          <button class="quiz-option" data-value="tight" data-next="3">
            <i class="fas fa-piggy-bank"></i>
            <div>
              <strong>Under $150</strong>
              <span>Need to save every dollar</span>
            </div>
          </button>
          <button class="quiz-option" data-value="moderate" data-next="3">
            <i class="fas fa-wallet"></i>
            <div>
              <strong>$150-$300</strong>
              <span>Reasonable budget</span>
            </div>
          </button>
          <button class="quiz-option" data-value="flexible" data-next="3">
            <i class="fas fa-credit-card"></i>
            <div>
              <strong>$300+</strong>
              <span>Quality matters most</span>
            </div>
          </button>
        </div>
      </div>
      
      <!-- Question 3 -->
      <div class="quiz-question" data-question="3">
        <h2>What's your cooking setup?</h2>
        <div class="quiz-options">
          <button class="quiz-option" data-value="microwave" data-next="4">
            <i class="fas fa-microwave"></i>
            <div>
              <strong>Microwave only</strong>
              <span>Dorm life</span>
            </div>
          </button>
          <button class="quiz-option" data-value="basic" data-next="4">
            <i class="fas fa-fire-burner"></i>
            <div>
              <strong>Microwave + hot plate</strong>
              <span>Basic setup</span>
            </div>
          </button>
          <button class="quiz-option" data-value="full" data-next="4">
            <i class="fas fa-kitchen-set"></i>
            <div>
              <strong>Full kitchen</strong>
              <span>Apartment living</span>
            </div>
          </button>
        </div>
      </div>
      
      <!-- Question 4 -->
      <div class="quiz-question" data-question="4">
        <h2>What's your main goal?</h2>
        <div class="quiz-options">
          <button class="quiz-option" data-value="time" data-next="5">
            <i class="fas fa-bolt"></i>
            <div>
              <strong>Save time</strong>
              <span>Speed is everything</span>
            </div>
          </button>
          <button class="quiz-option" data-value="money" data-next="5">
            <i class="fas fa-dollar-sign"></i>
            <div>
              <strong>Save money</strong>
              <span>Budget is tight</span>
            </div>
          </button>
          <button class="quiz-option" data-value="health" data-next="5">
            <i class="fas fa-heartbeat"></i>
            <div>
              <strong>Eat healthier</strong>
              <span>Fuel my body right</span>
            </div>
          </button>
          <button class="quiz-option" data-value="variety" data-next="5">
            <i class="fas fa-utensils"></i>
            <div>
              <strong>Learn to cook</strong>
              <span>Expand my skills</span>
            </div>
          </button>
        </div>
      </div>
      
      <!-- Question 5 -->
      <div class="quiz-question" data-question="5">
        <h2>How much support do you need?</h2>
        <div class="quiz-options">
          <button class="quiz-option" data-value="independent" data-next="result">
            <i class="fas fa-user"></i>
            <div>
              <strong>I'm self-sufficient</strong>
              <span>Just need recipes</span>
            </div>
          </button>
          <button class="quiz-option" data-value="moderate" data-next="result">
            <i class="fas fa-users"></i>
            <div>
              <strong>Some guidance</strong>
              <span>Community helps</span>
            </div>
          </button>
          <button class="quiz-option" data-value="full" data-next="result">
            <i class="fas fa-chalkboard-teacher"></i>
            <div>
              <strong>Full coaching</strong>
              <span>I want expert help</span>
            </div>
          </button>
        </div>
      </div>
      
      <!-- Results -->
      <div class="quiz-result" id="quiz-result">
        <div class="result-content">
          <h2>üéâ Your Perfect Match:</h2>
          <div class="recommended-plan">
            <div class="plan-badge">‚ú® Recommended for You</div>
            <h3 id="result-plan-name">Loading...</h3>
            <div class="plan-price">
              <span class="price-symbol">$</span>
              <span class="price-amount" id="result-price">0</span>
              <span class="price-period">/month</span>
            </div>
            <p id="result-description" class="result-desc">Loading...</p>
            
            <div class="why-section">
              <h4>üí° Why This Plan Is Perfect For You:</h4>
              <p id="result-reasoning">Loading...</p>
            </div>
            
            <h4 style="margin-top: 30px; margin-bottom: 15px;">What You'll Get:</h4>
            <ul class="result-features" id="result-features"></ul>
            <a href="#" id="result-cta" class="btn-get-plan">Get Started Now ‚Üí</a>
          </div>
          
          <div class="other-plans">
            <p>Not quite right? <a href="/pages/plans">View all plans</a> or take the quiz again.</p>
          </div>
          
          <button class="btn-retake" onclick="restartQuiz()">
            <i class="fas fa-redo"></i> Retake Quiz
          </button>
        </div>
      </div>
    </div>
    
    <div class="quiz-progress">
      <div class="progress-bar">
        <div class="progress-fill" id="progress-fill"></div>
      </div>
      <p class="progress-text">Question <span id="current-question">1</span> of 5</p>
    </div>
  </div>
</section>

<style>
  .meal-plan-quiz {
    min-height: 100vh;
    padding: 80px 20px;
    background: linear-gradient(135deg, #1d4035 0%, #b85a1f 100%);
  }
  
  .quiz-container {
    max-width: 800px;
    margin: 0 auto;
  }
  
  .quiz-header {
    text-align: center;
    color: white;
    margin-bottom: 50px;
  }
  
  .quiz-header h1 {
    font-size: 3rem;
    margin-bottom: 15px;
    font-weight: 700;
  }
  
  .quiz-header p {
    font-size: 1.2rem;
    opacity: 0.95;
  }
  
  #quiz-content {
    background: white;
    border-radius: 20px;
    padding: 50px;
    box-shadow: 0 10px 50px rgba(0,0,0,0.2);
    min-height: 500px;
  }
  
  .quiz-question {
    display: none;
  }
  
  .quiz-question.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .quiz-question h2 {
    font-size: 2rem;
    color: #1d4035;
    margin-bottom: 40px;
    text-align: center;
    font-weight: 700;
  }
  
  .quiz-options {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
  
  .quiz-option {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 25px;
    background: #f7f5f0;
    border: 3px solid transparent;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
    width: 100%;
  }
  
  .quiz-option:hover {
    border-color: #b85a1f;
    background: white;
    transform: translateX(10px);
  }
  
  .quiz-option i {
    font-size: 2rem;
    color: #b85a1f;
    min-width: 40px;
  }
  
  .quiz-option strong {
    display: block;
    font-size: 1.3rem;
    color: #1d4035;
    margin-bottom: 5px;
  }
  
  .quiz-option span {
    display: block;
    color: #666;
    font-size: 0.95rem;
  }
  
  .quiz-result {
    display: none;
  }
  
  .quiz-result.active {
    display: block;
    animation: fadeIn 0.5s ease;
  }
  
  .result-content h2 {
    font-size: 2.5rem;
    color: #1d4035;
    margin-bottom: 40px;
    text-align: center;
    font-weight: 700;
  }
  
  .recommended-plan {
    background: linear-gradient(135deg, #1d4035 0%, #b85a1f 100%);
    color: white;
    padding: 40px;
    border-radius: 16px;
    margin-bottom: 30px;
    position: relative;
  }
  
  .plan-badge {
    position: absolute;
    top: -15px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffd700;
    color: #1d4035;
    padding: 8px 20px;
    border-radius: 20px;
    font-weight: 700;
    font-size: 0.9rem;
  }
  
  .recommended-plan h3 {
    font-size: 2.5rem;
    margin-bottom: 20px;
    font-weight: 700;
    margin-top: 10px;
  }
  
  .plan-price {
    margin-bottom: 20px;
  }
  
  .price-symbol {
    font-size: 2rem;
    vertical-align: super;
  }
  
  .price-amount {
    font-size: 3.5rem;
    font-weight: 700;
  }
  
  .price-period {
    font-size: 1.2rem;
    opacity: 0.9;
  }
  
  .result-desc {
    font-size: 1.2rem;
    margin-bottom: 25px;
    opacity: 0.95;
    line-height: 1.6;
  }
  
  .why-section {
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 12px;
    margin: 25px 0;
    border-left: 4px solid #ffd700;
  }
  
  .why-section h4 {
    margin-bottom: 12px;
    font-size: 1.3rem;
  }
  
  .why-section p {
    line-height: 1.7;
    font-size: 1.05rem;
  }
  
  .result-features {
    list-style: none;
    padding: 0;
    margin: 0 0 30px 0;
    text-align: left;
  }
  
  .result-features li {
    padding: 12px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
    font-size: 1.05rem;
  }
  
  .result-features li:last-child {
    border-bottom: none;
  }
  
  .btn-get-plan {
    display: inline-block;
    padding: 18px 50px;
    background: white;
    color: #1d4035;
    text-decoration: none;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.2rem;
    transition: all 0.3s ease;
  }
  
  .btn-get-plan:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
  }
  
  .other-plans {
    margin: 30px 0;
    color: #666;
    text-align: center;
  }
  
  .other-plans a {
    color: #b85a1f;
    font-weight: 600;
    text-decoration: none;
  }
  
  .btn-retake {
    background: #f7f5f0;
    border: 2px solid #1d4035;
    color: #1d4035;
    padding: 12px 30px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: block;
    margin: 0 auto;
  }
  
  .btn-retake:hover {
    background: #1d4035;
    color: white;
  }
  
  .quiz-progress {
    margin-top: 30px;
    text-align: center;
  }
  
  .progress-bar {
    background: rgba(255,255,255,0.3);
    height: 8px;
    border-radius: 10px;
    overflow: hidden;
    margin-bottom: 10px;
  }
  
  .progress-fill {
    background: white;
    height: 100%;
    width: 20%;
    border-radius: 10px;
    transition: width 0.3s ease;
  }
  
  .progress-text {
    color: white;
    font-weight: 600;
  }
  
  @media (max-width: 768px) {
    #quiz-content {
      padding: 30px 20px;
    }
    
    .quiz-header h1 {
      font-size: 2rem;
    }
    
    .quiz-question h2 {
      font-size: 1.5rem;
    }
    
    .quiz-option {
      flex-direction: column;
      text-align: center;
    }
    
    .recommended-plan {
      padding: 30px 20px;
    }
  }
</style>

<script>
  let quizAnswers = {
    time: '',
    budget: '',
    setup: '',
    goal: '',
    support: ''
  };
  
  const questionKeys = ['time', 'budget', 'setup', 'goal', 'support'];
  
  document.addEventListener('DOMContentLoaded', function() {
    const options = document.querySelectorAll('.quiz-option');
    
    options.forEach(option => {
      option.addEventListener('click', function() {
        const questionNum = this.closest('.quiz-question').dataset.question;
        const value = this.dataset.value;
        const nextQuestion = this.dataset.next;
        
        const questionKey = questionKeys[parseInt(questionNum) - 1];
        quizAnswers[questionKey] = value;
        
        document.querySelector('.quiz-question.active').classList.remove('active');
        
        if (nextQuestion === 'result') {
          showResult();
        } else {
          document.querySelector('[data-question="' + nextQuestion + '"]').classList.add('active');
          updateProgress(nextQuestion);
        }
      });
    });
  });
  
  function updateProgress(questionNum) {
    var progress = (questionNum / 5) * 100;
    document.getElementById('progress-fill').style.width = progress + '%';
    document.getElementById('current-question').textContent = questionNum;
  }
  
  function showResult() {
    document.getElementById('progress-fill').style.width = '100%';
    document.getElementById('current-question').textContent = '5';
    
    var plan = calculatePlan();
    displayPlan(plan);
    
    document.getElementById('quiz-result').classList.add('active');
  }
  
  function calculatePlan() {
    var time = quizAnswers.time;
    var budget = quizAnswers.budget;
    var setup = quizAnswers.setup;
    var goal = quizAnswers.goal;
    var support = quizAnswers.support;
    
    if (budget === 'tight' && time === 'minimal' && support === 'independent') {
      return {
        name: 'Free Starter',
        price: '0',
        description: 'Perfect for students who need basic recipes and meal ideas without breaking the bank.',
        reasoning: 'Based on your tight budget and minimal time, you need quick wins without any financial commitment.',
        features: [
          '‚úì 3-minute meal preference quiz',
          '‚úì Personalized weekly recipe suggestions',
          '‚úì Basic grocery lists',
          '‚úì Quick-prep meal ideas (under 10 min)',
          '‚úì Email support'
        ],
        link: '/pages/signup-free'
      };
    }
    
    if ((budget === 'moderate' || budget === 'tight') && (time === 'moderate' || time === 'minimal')) {
      return {
        name: 'Quick Prep Pack',
        price: '5',
        description: 'Ideal for busy students who want better meals without spending hours cooking.',
        reasoning: 'You have a reasonable budget and need efficient meal solutions. For just $5/month, you will save time and money!',
        features: [
          '‚úì Everything in Free Starter',
          '‚úì AI-powered personalized grocery lists',
          '‚úì 50+ quick-prep recipes (5-15 min)',
          '‚úì Budget optimization calculator',
          '‚úì Basic nutrition tracking',
          '‚úì Weekly meal planning templates',
          '‚úì Priority email support'
        ],
        link: '/pages/signup-entry'
      };
    }
    
    if (support === 'full' || goal === 'variety') {
      return {
        name: 'Coaching + Community',
        price: '20',
        description: 'For students who want expert guidance and a supportive community.',
        reasoning: 'You are ready to invest in your health with personalized support and expert guidance.',
        features: [
          '‚úì Everything in Full Semester Plan',
          '‚úì Monthly 1-on-1 nutrition coaching calls',
          '‚úì Custom meal plans based on your goals',
          '‚úì Weekly group coaching sessions',
          '‚úì Community cooking challenges',
          '‚úì Access to registered dietitian',
          '‚úì 24/7 priority support'
        ],
        link: '/pages/signup-premium'
      };
    }
    
    return {
      name: 'Full Semester Plan',
      price: '12',
      description: 'The complete solution for students who want healthy eating made easy all semester long.',
      reasoning: 'You are looking for a comprehensive solution. The Full Semester Plan gives you everything you need!',
      features: [
        '‚úì Everything in Quick Prep Pack',
        '‚úì Full 16-week semester meal planner',
        '‚úì 200+ recipes with video tutorials',
        '‚úì Dorm-friendly & apartment recipes',
        '‚úì Weekly automated shopping schedules',
        '‚úì Student community access (Discord)',
        '‚úì Monthly live cooking workshops'
      ],
      link: '/pages/signup-flagship'
    };
  }
  
  function displayPlan(plan) {
    document.getElementById('result-plan-name').textContent = plan.name;
    document.getElementById('result-price').textContent = plan.price;
    document.getElementById('result-description').textContent = plan.description;
    document.getElementById('result-reasoning').textContent = plan.reasoning;
    document.getElementById('result-cta').href = plan.link;
    
    var featuresList = document.getElementById('result-features');
    featuresList.innerHTML = '';
    for (var i = 0; i < plan.features.length; i++) {
      var li = document.createElement('li');
      li.textContent = plan.features[i];
      featuresList.appendChild(li);
    }
  }
  
  function restartQuiz() {
    quizAnswers = {
      time: '',
      budget: '',
      setup: '',
      goal: '',
      support: ''
    };
    
    document.getElementById('quiz-result').classList.remove('active');
    var allQuestions = document.querySelectorAll('.quiz-question');
    for (var i = 0; i < allQuestions.length; i++) {
      allQuestions[i].classList.remove('active');
    }
    document.querySelector('[data-question="1"]').classList.add('active');
    
    document.getElementById('progress-fill').style.width = '20%';
    document.getElementById('current-question').textContent = '1';
  }
</script>
